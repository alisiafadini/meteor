<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<meta name="generator" content="pdoc3 0.11.3">
<title>meteor.tv API documentation</title>
<meta name="description" content="total variation denoising of maps">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/sanitize.min.css" integrity="sha512-y1dtMcuvtTMJc1yPgEqF0ZjQbhnc/bFhyvIyVNb9Zk5mIGtqVaAB1Ttl28su8AvFMOY0EwRbAe+HCLqj6W7/KA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/typography.min.css" integrity="sha512-Y1DYSb995BAfxobCkKepB1BqJJTPrOp3zPL74AWFugHHmmdcvO+C48WLrUOlhGMc0QG7AE3f7gmvvcrmX2fDoA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:1.5em;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:2em 0 .50em 0}h3{font-size:1.4em;margin:1.6em 0 .7em 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .2s ease-in-out}a:visited{color:#503}a:hover{color:#b62}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900;font-weight:bold}pre code{font-size:.8em;line-height:1.4em;padding:1em;display:block}code{background:#f3f3f3;font-family:"DejaVu Sans Mono",monospace;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em 1em;margin:1em 0}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul ul{padding-left:1em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7hBtkWpPWGt9wfbfaMGVt9gnyCvYa+jojwwPHLCzUm5i8rpk7vD7wNee9bA35eYIjobYPaQuKS1MQ==" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => {
hljs.configure({languages: ['bash', 'css', 'diff', 'graphql', 'ini', 'javascript', 'json', 'plaintext', 'python', 'python-repl', 'rust', 'shell', 'sql', 'typescript', 'xml', 'yaml']});
hljs.highlightAll();
})</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>meteor.tv</code></h1>
</header>
<section id="section-intro">
<p>total variation denoising of maps</p>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="meteor.tv.tv_denoise_difference_map"><code class="name flex">
<span>def <span class="ident">tv_denoise_difference_map</span></span>(<span>difference_map: Map,<br>*,<br>full_output: bool = False,<br>weights_to_scan: Sequence[float] | np.ndarray | None = None) ‑> <a title="meteor.rsmap.Map" href="rsmap.html#meteor.rsmap.Map">Map</a> | tuple[<a title="meteor.rsmap.Map" href="rsmap.html#meteor.rsmap.Map">Map</a>, <a title="meteor.tv.TvDenoiseResult" href="#meteor.tv.TvDenoiseResult">TvDenoiseResult</a>]</span>
</code></dt>
<dd>
<div class="desc"><p>Single-pass TV denoising of a difference map.</p>
<p>Automatically selects the optimal level of regularization (the TV weight, aka lambda) by
maximizing the negentropy of the denoised map. Two modes can be used to dictate which
candidate values of weights are assessed:</p>
<ol>
<li>By default (<code>weights_to_scan=None</code>), the golden-section search algorithm selects
a weights value according to the bounds and convergence criteria set in meteor.settings.</li>
<li>Alternatively, an explicit list of weights values to assess can be provided using
<code>weights_to_scan</code>.</li>
</ol>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>difference_map</code></strong> :&ensp;<code>Map</code></dt>
<dd>The input dataset containing the difference map coefficients (amplitude and phase)
that will be used to compute the difference map.</dd>
<dt><strong><code>full_output</code></strong> :&ensp;<code>bool</code>, optional</dt>
<dd>If <code>True</code>, the function returns both the denoised map coefficients and a <code><a title="meteor.tv.TvDenoiseResult" href="#meteor.tv.TvDenoiseResult">TvDenoiseResult</a></code>
object containing the optimal weight and the associated negentropy. If <code>False</code>, only
the denoised map coefficients are returned. Default is <code>False</code>.</dd>
<dt><strong><code>weights_to_scan</code></strong> :&ensp;<code>Sequence[float] | None</code>, optional</dt>
<dd>A sequence of weight values to explicitly scan for determining the optimal value. If
<code>None</code>, the function uses the golden-section search method to determine the optimal
weight. Default is <code>None</code>.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>Map | tuple[Map, TvDenoiseResult]</code></dt>
<dd>If <code>full_output</code> is <code>False</code>, returns a <code>Map</code>, the denoised map coefficients.
If <code>full_output</code> is <code>True</code>, returns a tuple containing:
- <code>Map</code>: The denoised map coefficients.
- <code><a title="meteor.tv.TvDenoiseResult" href="#meteor.tv.TvDenoiseResult">TvDenoiseResult</a></code>: An object w/ the optimal weight and the corresponding negentropy.</dd>
</dl>
<h2 id="raises">Raises</h2>
<dl>
<dt><code>AssertionError</code></dt>
<dd>If the golden-section search fails to find an optimal weight.</dd>
</dl>
<h2 id="notes">Notes</h2>
<ul>
<li>The function is designed to maximize the negentropy of the denoised map, which is a
measure of the map's "randomness."
Higher negentropy generally corresponds to a more informative and less noisy map.</li>
<li>The golden-section search is a robust method for optimizing unimodal functions,
particularly suited for scenarios where an explicit list of candidate values is not provided.</li>
</ul>
<h2 id="example">Example</h2>
<pre><code class="language-python-repl">&gt;&gt;&gt; coefficients = Map.read_mtz(&quot;./path/to/difference_map.mtz&quot;, ...)  # load dataset
&gt;&gt;&gt; denoised_map, result = tv_denoise_difference_map(coefficients, full_output=True)
&gt;&gt;&gt; print(f&quot;Optimal: {result.optimal_tv_weight}, Negentropy: {result.optimal_negentropy}&quot;)
</code></pre></div>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="meteor.tv.TvDenoiseResult"><code class="flex name class">
<span>class <span class="ident">TvDenoiseResult</span></span>
<span>(</span><span>initial_negentropy: float,<br>optimal_tv_weight: float,<br>optimal_negentropy: float,<br>map_sampling_used_for_tv: float,<br>tv_weights_scanned: list[float],<br>negentropy_at_weights: list[float],<br>k_parameter_used: float | None = None)</span>
</code></dt>
<dd>
<div class="desc"><p>TvDenoiseResult(initial_negentropy: 'float', optimal_tv_weight: 'float', optimal_negentropy: 'float', map_sampling_used_for_tv: 'float', tv_weights_scanned: 'list[float]', negentropy_at_weights: 'list[float]', k_parameter_used: 'float | None' = None)</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@dataclass
class TvDenoiseResult:
    # constants for JSON format
    _scan_name = &#34;scan&#34;
    _weight_name = &#34;weight&#34;
    _negentropy_name = &#34;negentropy&#34;

    initial_negentropy: float
    optimal_tv_weight: float
    optimal_negentropy: float
    map_sampling_used_for_tv: float
    tv_weights_scanned: list[float]
    negentropy_at_weights: list[float]
    k_parameter_used: float | None = None

    def json(self) -&gt; dict:
        json_payload = asdict(self)
        json_payload.pop(&#34;tv_weights_scanned&#34;)
        json_payload.pop(&#34;negentropy_at_weights&#34;)
        json_payload[self._scan_name] = [
            {
                self._weight_name: float(self.tv_weights_scanned[idx]),
                self._negentropy_name: float(self.negentropy_at_weights[idx]),
            }
            for idx in range(len(self.tv_weights_scanned))
        ]
        return json_payload

    def to_json_file(self, filename: Path) -&gt; None:
        with filename.open(&#34;w&#34;) as f:
            json.dump(self.json(), f, indent=4)

    @classmethod
    def from_json(cls, json_payload: dict) -&gt; TvDenoiseResult:
        try:
            data = json_payload.pop(cls._scan_name)
            json_payload[&#34;tv_weights_scanned&#34;] = [float(point[cls._weight_name]) for point in data]
            json_payload[&#34;negentropy_at_weights&#34;] = [
                float(point[cls._negentropy_name]) for point in data
            ]
            return cls(**json_payload)

        except Exception as exptn:
            msg = &#34;could not load json payload; mis-formatted&#34;
            raise ValueError(msg) from exptn

    @classmethod
    def from_json_file(cls, filename: Path) -&gt; TvDenoiseResult:
        with filename.open(&#34;r&#34;) as f:
            json_payload = json.load(f)
        return cls.from_json(json_payload)</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="meteor.tv.TvDenoiseResult.initial_negentropy"><code class="name">var <span class="ident">initial_negentropy</span> : float</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="meteor.tv.TvDenoiseResult.k_parameter_used"><code class="name">var <span class="ident">k_parameter_used</span> : float | None</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="meteor.tv.TvDenoiseResult.map_sampling_used_for_tv"><code class="name">var <span class="ident">map_sampling_used_for_tv</span> : float</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="meteor.tv.TvDenoiseResult.negentropy_at_weights"><code class="name">var <span class="ident">negentropy_at_weights</span> : list[float]</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="meteor.tv.TvDenoiseResult.optimal_negentropy"><code class="name">var <span class="ident">optimal_negentropy</span> : float</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="meteor.tv.TvDenoiseResult.optimal_tv_weight"><code class="name">var <span class="ident">optimal_tv_weight</span> : float</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="meteor.tv.TvDenoiseResult.tv_weights_scanned"><code class="name">var <span class="ident">tv_weights_scanned</span> : list[float]</code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
<h3>Static methods</h3>
<dl>
<dt id="meteor.tv.TvDenoiseResult.from_json"><code class="name flex">
<span>def <span class="ident">from_json</span></span>(<span>json_payload: dict) ‑> <a title="meteor.tv.TvDenoiseResult" href="#meteor.tv.TvDenoiseResult">TvDenoiseResult</a></span>
</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="meteor.tv.TvDenoiseResult.from_json_file"><code class="name flex">
<span>def <span class="ident">from_json_file</span></span>(<span>filename: Path) ‑> <a title="meteor.tv.TvDenoiseResult" href="#meteor.tv.TvDenoiseResult">TvDenoiseResult</a></span>
</code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="meteor.tv.TvDenoiseResult.json"><code class="name flex">
<span>def <span class="ident">json</span></span>(<span>self) ‑> dict</span>
</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="meteor.tv.TvDenoiseResult.to_json_file"><code class="name flex">
<span>def <span class="ident">to_json_file</span></span>(<span>self, filename: Path) ‑> None</span>
</code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="meteor" href="index.html">meteor</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="meteor.tv.tv_denoise_difference_map" href="#meteor.tv.tv_denoise_difference_map">tv_denoise_difference_map</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="meteor.tv.TvDenoiseResult" href="#meteor.tv.TvDenoiseResult">TvDenoiseResult</a></code></h4>
<ul class="">
<li><code><a title="meteor.tv.TvDenoiseResult.from_json" href="#meteor.tv.TvDenoiseResult.from_json">from_json</a></code></li>
<li><code><a title="meteor.tv.TvDenoiseResult.from_json_file" href="#meteor.tv.TvDenoiseResult.from_json_file">from_json_file</a></code></li>
<li><code><a title="meteor.tv.TvDenoiseResult.initial_negentropy" href="#meteor.tv.TvDenoiseResult.initial_negentropy">initial_negentropy</a></code></li>
<li><code><a title="meteor.tv.TvDenoiseResult.json" href="#meteor.tv.TvDenoiseResult.json">json</a></code></li>
<li><code><a title="meteor.tv.TvDenoiseResult.k_parameter_used" href="#meteor.tv.TvDenoiseResult.k_parameter_used">k_parameter_used</a></code></li>
<li><code><a title="meteor.tv.TvDenoiseResult.map_sampling_used_for_tv" href="#meteor.tv.TvDenoiseResult.map_sampling_used_for_tv">map_sampling_used_for_tv</a></code></li>
<li><code><a title="meteor.tv.TvDenoiseResult.negentropy_at_weights" href="#meteor.tv.TvDenoiseResult.negentropy_at_weights">negentropy_at_weights</a></code></li>
<li><code><a title="meteor.tv.TvDenoiseResult.optimal_negentropy" href="#meteor.tv.TvDenoiseResult.optimal_negentropy">optimal_negentropy</a></code></li>
<li><code><a title="meteor.tv.TvDenoiseResult.optimal_tv_weight" href="#meteor.tv.TvDenoiseResult.optimal_tv_weight">optimal_tv_weight</a></code></li>
<li><code><a title="meteor.tv.TvDenoiseResult.to_json_file" href="#meteor.tv.TvDenoiseResult.to_json_file">to_json_file</a></code></li>
<li><code><a title="meteor.tv.TvDenoiseResult.tv_weights_scanned" href="#meteor.tv.TvDenoiseResult.tv_weights_scanned">tv_weights_scanned</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.11.3</a>.</p>
</footer>
</body>
</html>
